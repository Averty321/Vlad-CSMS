<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è</title>
    <style>
        /* ===== –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò ===== */
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { margin: 0; padding: 20px; background: #f5f7fa; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        
        /* ===== –ü–ê–ù–ï–õ–¨ –°–¢–ê–¢–ò–°–¢–ò–ö–ò ===== */
        .stats { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .stat-card { flex: 1; min-width: 200px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-left: 4px solid #3498db; }
        .stat-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #7f8c8d; }
        .stat-card .value { font-size: 24px; font-weight: bold; color: #2c3e50; }
        
        /* ===== –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø ===== */
        .controls { display: flex; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .left-controls, .right-controls { display: flex; gap: 15px; flex-wrap: wrap; }
        .search-box { display: flex; align-items: center; }
        .search-box input { padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; width: 250px; }
        
        /* ===== –ö–ù–û–ü–ö–ò –ò –§–û–†–ú–´ ===== */
        .btn { padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 5px; }
        .btn:hover { background: #2980b9; }
        .btn-add { background: #2ecc71; }
        .btn-add:hover { background: #27ae60; }
        .btn-edit { background: #f39c12; padding: 5px 10px; font-size: 13px; }
        .btn-delete { background: #e74c3c; padding: 5px 10px; font-size: 13px; }
        .btn-restore { background: #3498db; padding: 5px 10px; font-size: 13px; }
        .btn-excel { background: #1d6f42; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 4px; }
        
        /* ===== –¢–ê–ë–õ–ò–¶–ê ===== */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        th, td { padding: 12px 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #3498db; color: white; position: sticky; top: 0; }
        tr:hover { background: #f1f8ff; }
        
        /* ===== –°–¢–ê–¢–£–°–´ –ò –ò–ù–î–ò–ö–ê–¢–û–†–´ ===== */
        .barcode-status, .status-written-off, .status-new { padding: 5px 10px; border-radius: 20px; font-size: 0.85em; text-align: center; display: inline-block; min-width: 80px; }
        .barcode-active { background: #d4edda; color: #155724; }
        .barcode-inactive { background: #f8d7da; color: #721c24; }
        .status-written-off { background: #fff3cd; color: #856404; }
        .status-new { background: #e8f4fc; color: #2980b9; }
        .row-written-off { background: #fff3cd !important; }
        
        /* ===== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ===== */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 30px; border-radius: 8px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; }
        
        /* ===== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ===== */
        @media (max-width: 768px) {
            .controls { flex-direction: column; }
            .left-controls, .right-controls { width: 100%; justify-content: space-between; }
            .search-box input { width: 100%; }
            table { display: block; overflow-x: auto; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì¶ –°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è</h1>
        
        <!-- === –ü–ê–ù–ï–õ–¨ –°–¢–ê–¢–ò–°–¢–ò–ö–ò === -->
        <div class="stats">
            <div class="stat-card"><h3>–í—Å–µ–≥–æ –ø–æ–∑–∏—Ü–∏–π</h3><div class="value" id="totalItems">0</div></div>
            <div class="stat-card"><h3>–°–ø–∏—Å–∞–Ω–æ</h3><div class="value" id="writtenOffItems">0</div></div>
            <div class="stat-card"><h3>–ù–æ–≤—ã–µ</h3><div class="value" id="newItems">0</div></div>
        </div>
        
        <!-- === –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø === -->
        <div class="controls">
            <div class="left-controls">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—é –∏–ª–∏ –Ω–æ–º–µ—Ä—É...">
                </div>
                <button class="btn btn-add" id="addItemBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é</button>
            </div>
            <div class="right-controls">
                <button class="btn btn-excel" id="importExcelBtn">üìä –ò–º–ø–æ—Ä—Ç –∏–∑ Excel</button>
                <button class="btn btn-excel" id="exportExcelBtn">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
            </div>
        </div>
        
        <!-- === –û–°–ù–û–í–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê === -->
        <table>
            <thead>
                <tr>
                    <th width="40">‚Ññ</th>
                    <th width="200">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                    <th width="140">–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–Ω—ã–π –Ω–æ–º–µ—Ä</th>
                    <th width="180">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                    <th width="150">–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ</th>
                    <th width="140">–°–æ—Å—Ç–æ—è–Ω–∏–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞</th>
                    <th width="120">–°—Ç–∞—Ç—É—Å</th>
                    <th width="200">–û–ø–µ—Ä–∞—Ü–∏–∏</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <!-- === –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–û–ë–ê–í–õ–ï–ù–ò–Ø/–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø === -->
    <div class="modal" id="itemModal">
        <div class="modal-content">
            <h2 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é</h2>
            <form id="itemForm">
                <div class="form-group"><label>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ *</label><input type="text" id="itemName" required placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"></div>
                <div class="form-group"><label>–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–Ω—ã–π –Ω–æ–º–µ—Ä *</label><input type="text" id="itemNumber" required placeholder="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä"></div>
                <div class="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ *</label>
                    <div style="display: flex; gap: 15px;">
                        <div style="flex: 1;"><label>–ü–æ —Å–ø–∏—Å–∫—É</label><input type="number" id="quantityList" min="0" required value="0"></div>
                        <div style="flex: 1;"><label>–ü–æ —Ñ–∞–∫—Ç—É</label><input type="number" id="quantityFact" min="0" required value="0"></div>
                    </div>
                </div>
                <div class="form-group"><label>–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ *</label><input type="text" id="location" required placeholder="–°–∫–ª–∞–¥, —Å—Ç–µ–ª–ª–∞–∂, –ø–æ–ª–∫–∞"></div>
                <div class="form-group">
                    <label>–°–æ—Å—Ç–æ—è–Ω–∏–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞ *</label>
                    <select id="barcodeStatus" required>
                        <option value="active">–ê–∫—Ç–∏–≤–µ–Ω</option>
                        <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</option>
                    </select>
                </div>
                <div class="form-group"><label>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label><textarea id="notes" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."></textarea></div>
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 25px; padding-top: 15px; border-top: 1px solid #eee;">
                    <button type="button" class="btn" id="cancelBtn">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-add">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- === –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ò–ú–ü–û–†–¢–ê === -->
    <div class="modal" id="excelModal">
        <div class="modal-content">
            <h2>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel</h2>
            <div class="form-group">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª Excel</label>
                <div style="position: relative; display: inline-block; width: 100%;">
                    <button class="btn btn-excel" style="width: 100%">üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª Excel</button>
                    <input type="file" id="excelFile" accept=".xlsx, .xls, .csv" style="position: absolute; left: 0; top: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
                </div>
                <div id="fileName" style="margin-top: 10px; font-style: italic;"></div>
            </div>
            
            <div style="background-color: #e8f4fc; padding: 15px; border-radius: 4px; margin-top: 20px; border-left: 4px solid #3498db;">
                <h3 style="margin-top: 0; color: #2c3e50;">–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏–º–ø–æ—Ä—Ç–∞:</h3>
                <ul style="margin-bottom: 0; padding-left: 20px;">
                    <li><strong>–ù–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏</strong> - –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü—É</li>
                    <li><strong>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏</strong> - –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã</li>
                    <li><strong>–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ —Ñ–∞–π–ª–µ –ø–æ–∑–∏—Ü–∏–∏</strong> - –±—É–¥—É—Ç –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ "–°–ø–∏—Å–∞–Ω–æ"</li>
                    <li>–î—É–±–ª–∏–∫–∞—Ç—ã –ø–æ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–Ω–æ–º—É –Ω–æ–º–µ—Ä—É –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è</li>
                </ul>
            </div>
            
            <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 25px; padding-top: 15px; border-top: 1px solid #eee;">
                <button type="button" class="btn" id="cancelExcelBtn">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-excel" id="processExcelBtn" disabled>–ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç</button>
            </div>
        </div>
    </div>

    <!-- === –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø === -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <h2 id="confirmationTitle">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
            <p id="confirmationMessage">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ?</p>
            <div style="display: flex; justify-content: center; gap: 15px; margin-top: 20px;">
                <button class="btn" id="confirmCancelBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-delete" id="confirmActionBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // ===== –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
        let inventoryData = JSON.parse(localStorage.getItem('inventoryData')) || [
            {id: 1, name: "–ù–æ—É—Ç–±—É–∫ Dell XPS 13", number: "NTP-001", quantityList: 5, quantityFact: 5, location: "–°–∫–ª–∞–¥ –ê, –ø–æ–ª–∫–∞ 2", barcodeStatus: "active", status: "active", notes: "–î–ª—è –æ—Ç–¥–µ–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"},
            {id: 2, name: "–ú–æ–Ω–∏—Ç–æ—Ä Samsung 24\"", number: "MON-002", quantityList: 10, quantityFact: 8, location: "–°–∫–ª–∞–¥ –ë, –ø–æ–ª–∫–∞ 5", barcodeStatus: "active", status: "active", notes: ""},
            {id: 3, name: "–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ Logitech", number: "KEY-003", quantityList: 15, quantityFact: 12, location: "–°–∫–ª–∞–¥ –ê, –ø–æ–ª–∫–∞ 1", barcodeStatus: "inactive", status: "active", notes: "–¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∞ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞"}
        ];

        let nextId = Math.max(...inventoryData.map(item => item.id), 0) + 1;
        let currentEditingId = null;
        let pendingAction = null;
        let pendingItemId = null;

        // ===== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveData() {
            localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('totalItems').textContent = inventoryData.length;
            document.getElementById('writtenOffItems').textContent = inventoryData.filter(item => item.status === 'written-off').length;
            document.getElementById('newItems').textContent = inventoryData.filter(item => item.status === 'new').length;
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
        function renderTable(data = inventoryData) {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            data.forEach((item, index) => {
                const row = document.createElement('tr');
                if (item.status === 'written-off') row.classList.add('row-written-off');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.name}</td>
                    <td>${item.number}</td>
                    <td>
                        <div style="display: flex; gap: 8px;">
                            <div style="flex: 1; text-align: center; padding: 5px; border-radius: 4px; background: #e8f4fc; color: #2980b9; font-weight: 600;">${item.quantityList}</div>
                            <div style="flex: 1; text-align: center; padding: 5px; border-radius: 4px; background: #e8f8f0; color: #27ae60; font-weight: 600;">${item.quantityFact}</div>
                        </div>
                    </td>
                    <td>${item.location}</td>
                    <td>
                        <span class="barcode-status ${item.barcodeStatus === 'active' ? 'barcode-active' : 'barcode-inactive'}">
                            ${item.barcodeStatus === 'active' ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                        </span>
                    </td>
                    <td>
                        ${item.status === 'written-off' ? '<span class="status-written-off">–°–ø–∏—Å–∞–Ω–æ</span>' : 
                          item.status === 'new' ? '<span class="status-new">–ù–æ–≤—ã–π</span>' : 
                          '<span style="color: #6c757d;">–ê–∫—Ç–∏–≤–µ–Ω</span>'}
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                            ${item.status === 'written-off' ? 
                                `<button class="btn btn-restore" data-id="${item.id}">‚Üª –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                                 <button class="btn btn-delete" data-id="${item.id}">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>` :
                                `<button class="btn btn-edit" data-id="${item.id}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                 <button class="btn btn-delete" data-id="${item.id}">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>`
                            }
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ
            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', (e) => editItem(parseInt(e.target.getAttribute('data-id'))));
            });
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', (e) => showConfirmation('delete', parseInt(e.target.getAttribute('data-id'))));
            });
            document.querySelectorAll('.btn-restore').forEach(btn => {
                btn.addEventListener('click', (e) => showConfirmation('restore', parseInt(e.target.getAttribute('data-id'))));
            });
            
            updateStats();
            saveData();
        }

        // ===== –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° –ü–û–ó–ò–¶–ò–Ø–ú–ò =====
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
        function addItem() {
            currentEditingId = null;
            document.getElementById('modalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é';
            document.getElementById('itemForm').reset();
            document.getElementById('quantityList').value = '0';
            document.getElementById('quantityFact').value = '0';
            document.getElementById('itemModal').style.display = 'flex';
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
        function editItem(id) {
            const item = inventoryData.find(item => item.id === id);
            if (!item) return;
            
            currentEditingId = id;
            document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é';
            
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemNumber').value = item.number;
            document.getElementById('quantityList').value = item.quantityList;
            document.getElementById('quantityFact').value = item.quantityFact;
            document.getElementById('location').value = item.location;
            document.getElementById('barcodeStatus').value = item.barcodeStatus;
            document.getElementById('notes').value = item.notes || '';
            
            document.getElementById('itemModal').style.display = 'flex';
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
        function deleteItem(id) {
            inventoryData = inventoryData.filter(item => item.id !== id);
            renderTable();
        }

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
        function restoreItem(id) {
            const item = inventoryData.find(item => item.id === id);
            if (item) {
                item.status = 'active';
                renderTable();
            }
        }

        // ===== –§–£–ù–ö–¶–ò–ò –í–ê–õ–ò–î–ê–¶–ò–ò =====
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–æ–º–µ—Ä–∞
        function isNumberUnique(number, excludeId = null) {
            return !inventoryData.some(item => item.number === number && item.id !== excludeId);
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
        function validateForm(formData, excludeId = null) {
            if (!formData.name.trim()) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ');
                return false;
            }
            if (!formData.number.trim()) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–Ω—ã–π –Ω–æ–º–µ—Ä');
                return false;
            }
            if (!isNumberUnique(formData.number, excludeId)) {
                alert('–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º');
                return false;
            }
            if (formData.quantityList < 0 || formData.quantityFact < 0) {
                alert('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º');
                return false;
            }
            if (!formData.location.trim()) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ');
                return false;
            }
            return true;
        }

        // ===== –§–£–ù–ö–¶–ò–ò –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø –î–ï–ô–°–¢–í–ò–ô =====
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        function showConfirmation(action, itemId) {
            pendingAction = action;
            pendingItemId = itemId;
            
            const item = inventoryData.find(item => item.id === itemId);
            
            if (action === 'delete') {
                document.getElementById('confirmationTitle').textContent = '–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏';
                document.getElementById('confirmationMessage').textContent = `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é "${item.name}" (${item.number})?`;
                document.getElementById('confirmActionBtn').className = 'btn btn-delete';
                document.getElementById('confirmActionBtn').textContent = '–£–¥–∞–ª–∏—Ç—å';
            } else {
                document.getElementById('confirmationTitle').textContent = '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏';
                document.getElementById('confirmationMessage').textContent = `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é "${item.name}" (${item.number})?`;
                document.getElementById('confirmActionBtn').className = 'btn btn-add';
                document.getElementById('confirmActionBtn').textContent = '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
            }
            
            document.getElementById('confirmationModal').style.display = 'flex';
        }

        // –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
        function executePendingAction() {
            if (pendingAction === 'delete') {
                deleteItem(pendingItemId);
            } else {
                restoreItem(pendingItemId);
            }
            document.getElementById('confirmationModal').style.display = 'none';
            pendingAction = null;
            pendingItemId = null;
        }

        // ===== –§–£–ù–ö–¶–ò–ò –ò–ú–ü–û–†–¢–ê/–≠–ö–°–ü–û–†–¢–ê =====
        
        // –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function parseExcelData(file) {
            return new Promise((resolve) => {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–∞
                // –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                setTimeout(() => {
                    resolve([
                        {name: "–ù–æ—É—Ç–±—É–∫ Dell XPS 13", number: "NTP-001", quantityList: 5, quantityFact: 5, location: "–°–∫–ª–∞–¥ –ê, –ø–æ–ª–∫–∞ 2", barcodeStatus: "active"},
                        {name: "–ú–æ–Ω–∏—Ç–æ—Ä Samsung 24\"", number: "MON-002", quantityList: 10, quantityFact: 9, location: "–°–∫–ª–∞–¥ –ë, –ø–æ–ª–∫–∞ 5", barcodeStatus: "active"},
                        {name: "–ú—ã—à—å –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–∞—è", number: "MOU-004", quantityList: 20, quantityFact: 18, location: "–°–∫–ª–∞–¥ –ë, –ø–æ–ª–∫–∞ 3", barcodeStatus: "active"}
                    ]);
                }, 500);
            });
        }

        // –£–º–Ω—ã–π –∏–º–ø–æ—Ä—Ç
        function smartImport(excelData) {
            const excelNumbers = new Set(excelData.map(item => item.number));
            
            let newItemsCount = 0;
            let updatedItemsCount = 0;
            
            // –ü–æ–º–µ—Ç–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–∞–∫ —Å–ø–∏—Å–∞–Ω–Ω—ã–µ
            inventoryData.forEach(item => {
                if (!excelNumbers.has(item.number) && item.status !== 'written-off') {
                    item.status = 'written-off';
                }
            });
            
            // –î–æ–±–∞–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏
            excelData.forEach(excelItem => {
                const existing = inventoryData.find(item => item.number === excelItem.number);
                if (existing) {
                    Object.assign(existing, {...excelItem, status: 'active'});
                    updatedItemsCount++;
                } else {
                    inventoryData.push({...excelItem, id: nextId++, status: 'new'});
                    newItemsCount++;
                }
            });
            
            return { newItemsCount, updatedItemsCount };
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
        function exportToCSV() {
            const headers = ['–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', '–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–Ω—ã–π –Ω–æ–º–µ—Ä', '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ —Å–ø–∏—Å–∫—É', '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ —Ñ–∞–∫—Ç—É', '–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ', '–°–æ—Å—Ç–æ—è–Ω–∏–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞', '–°—Ç–∞—Ç—É—Å', '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è'];
            const csv = [
                headers.join(','),
                ...inventoryData.map(item => [
                    `"${item.name}"`,
                    `"${item.number}"`,
                    item.quantityList,
                    item.quantityFact,
                    `"${item.location}"`,
                    `"${item.barcodeStatus === 'active' ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}"`,
                    `"${item.status === 'written-off' ? '–°–ø–∏—Å–∞–Ω–æ' : item.status === 'new' ? '–ù–æ–≤—ã–π' : '–ê–∫—Ç–∏–≤–µ–Ω'}"`,
                    `"${item.notes || ''}"`
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å_${new Date().toISOString().split('T')[0]}.csv`;
            a.style.visibility = 'hidden';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô =====
        
        // –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        document.getElementById('itemForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('itemName').value,
                number: document.getElementById('itemNumber').value,
                quantityList: parseInt(document.getElementById('quantityList').value),
                quantityFact: parseInt(document.getElementById('quantityFact').value),
                location: document.getElementById('location').value,
                barcodeStatus: document.getElementById('barcodeStatus').value,
                notes: document.getElementById('notes').value
            };
            
            if (!validateForm(formData, currentEditingId)) return;
            
            if (currentEditingId) {
                const index = inventoryData.findIndex(item => item.id === currentEditingId);
                if (index !== -1) inventoryData[index] = {...inventoryData[index], ...formData};
            } else {
                inventoryData.push({...formData, id: nextId++, status: 'active'});
            }
            
            renderTable();
            document.getElementById('itemModal').style.display = 'none';
        });

        // –ü–æ–∏—Å–∫
        document.getElementById('searchInput').addEventListener('input', function() {
            const term = this.value.toLowerCase();
            if (!term) return renderTable();
            
            const filtered = inventoryData.filter(item => 
                item.name.toLowerCase().includes(term) || 
                item.number.toLowerCase().includes(term) ||
                item.location.toLowerCase().includes(term)
            );
            renderTable(filtered);
        });

        // –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞
        document.getElementById('excelFile').addEventListener('change', async function() {
            if (!this.files.length) return;
            
            document.getElementById('fileName').textContent = `–í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª: ${this.files[0].name}`;
            document.getElementById('processExcelBtn').disabled = true;
            document.getElementById('processExcelBtn').textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            
            try {
                const data = await parseExcelData(this.files[0]);
                const result = smartImport(data);
                renderTable();
                
                alert(`–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!\n\n–ù–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π: ${result.newItemsCount}\n–û–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ–∑–∏—Ü–∏–π: ${result.updatedItemsCount}\n–°–ø–∏—Å–∞–Ω–æ –ø–æ–∑–∏—Ü–∏–π: ${inventoryData.filter(item => item.status === 'written-off').length}`);
                document.getElementById('excelModal').style.display = 'none';
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + error.message);
            }
            
            document.getElementById('processExcelBtn').disabled = false;
            document.getElementById('processExcelBtn').textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç';
        });

        // ===== –ù–ê–°–¢–†–û–ô–ö–ê –û–°–ù–û–í–ù–´–• –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í =====
        
        // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        document.getElementById('addItemBtn').addEventListener('click', addItem);
        document.getElementById('importExcelBtn').addEventListener('click', () => {
            document.getElementById('excelModal').style.display = 'flex';
            document.getElementById('excelFile').value = '';
            document.getElementById('fileName').textContent = '';
            document.getElementById('processExcelBtn').disabled = true;
            document.getElementById('processExcelBtn').textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç';
        });
        document.getElementById('exportExcelBtn').addEventListener('click', exportToCSV);

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        document.getElementById('cancelBtn').addEventListener('click', () => {
            document.getElementById('itemModal').style.display = 'none';
        });
        document.getElementById('cancelExcelBtn').addEventListener('click', () => {
            document.getElementById('excelModal').style.display = 'none';
        });
        document.getElementById('confirmCancelBtn').addEventListener('click', () => {
            document.getElementById('confirmationModal').style.display = 'none';
            pendingAction = null;
            pendingItemId = null;
        });
        document.getElementById('confirmActionBtn').addEventListener('click', executePendingAction);

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
        window.addEventListener('click', (e) => {
            if (e.target === document.getElementById('itemModal')) document.getElementById('itemModal').style.display = 'none';
            if (e.target === document.getElementById('excelModal')) document.getElementById('excelModal').style.display = 'none';
            if (e.target === document.getElementById('confirmationModal')) document.getElementById('confirmationModal').style.display = 'none';
        });

        // ===== –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø =====
        document.addEventListener('DOMContentLoaded', () => {
            renderTable();
        });
    </script>
</body>
</html>
